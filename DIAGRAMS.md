# ğŸ“Š Project Pluto - Visual Diagrams

## ğŸ—ºï¸ System Overview Diagram

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         ğŸª PROJECT PLUTO                              â•‘
â•‘              Offline Voice Assistant Test Architecture                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    ğŸ‘¤ USER                          ğŸ–¥ï¸  LAPTOP
     â”‚                                  â”‚
     â”‚ speaks                           â”‚
     â–¼                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  ğŸ¤ MICROPHONE  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Raw Audio (16kHz)
         â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    STT WORKER (Vosk)                               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ PyAudio  â”‚â”€â”€â–¶â”‚ VAD  â”‚â”€â”€â–¶â”‚ Vosk Model â”‚â”€â”€â–¶â”‚ Text Transcript  â”‚ â•‘
â•‘  â”‚ Capture  â”‚   â”‚Energyâ”‚   â”‚   ~40MB    â”‚   â”‚                  â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         â”‚ {"type": "transcript", "text": "hello"}
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  QUEUE 1: STTâ†’LLM â”‚  (Thread-safe, max 10 items)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Transcript
         â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  LLM WORKER (Ollama + Qwen2.5)                     â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚  Receive   â”‚â”€â”€â–¶â”‚  Ollama  â”‚â”€â”€â–¶â”‚  Qwen2.5    â”‚â”€â”€â–¶â”‚ Response  â”‚  â•‘
â•‘  â”‚ Transcript â”‚   â”‚ HTTP API â”‚   â”‚  1.5B-q4    â”‚  â”‚   Text    â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         â”‚ {"type": "response", "text": "Hi there!"}
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  QUEUE 2: LLMâ†’TTS â”‚  (Thread-safe, max 10 items)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Response
         â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   TTS WORKER (Piper)                               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚  Receive   â”‚â”€â”€â–¶â”‚  Piper   â”‚â”€â”€â–¶â”‚   WAV    â”‚â”€â”€â–¶â”‚  PyAudio    â”‚  â•‘
â•‘  â”‚  Response  â”‚   â”‚  ONNX    â”‚   â”‚  22kHz   â”‚   â”‚  Playback   â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         â”‚ Audio Output
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”Š SPEAKERS    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
     ğŸ‘¤ USER hears response

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

         â±ï¸  METRICS LOGGER (Continuous Monitoring)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ğŸ“Š Latencies | ğŸ’¾ Memory | ğŸ“¦ Queue Depths         â”‚
    â”‚  â”œâ”€ STT: 100-200ms                                  â”‚
    â”‚  â”œâ”€ LLM: 500-1500ms  âš ï¸  BOTTLENECK                â”‚
    â”‚  â”œâ”€ TTS: 200-500ms                                  â”‚
    â”‚  â””â”€ Total: 800-2200ms                               â”‚
    â”‚                                                      â”‚
    â”‚  Output: CSV + JSON + Console + Summary             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ§µ Thread Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MAIN PROCESS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Main Thread (Orchestrator)                                â”‚   â”‚
â”‚  â”‚  - Initialize workers                                      â”‚   â”‚
â”‚  â”‚  - Monitor system health                                   â”‚   â”‚
â”‚  â”‚  - Handle shutdown signals                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  STT Worker Thread (daemon)                                â”‚   â”‚
â”‚  â”‚  while running:                                            â”‚   â”‚
â”‚  â”‚      audio_data = stream.read()                            â”‚   â”‚
â”‚  â”‚      if is_speech(audio_data):                             â”‚   â”‚
â”‚  â”‚          text = vosk.recognize(audio_data)                 â”‚   â”‚
â”‚  â”‚          stt_to_llm_queue.put(text)                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  LLM Worker Thread (daemon)                                â”‚   â”‚
â”‚  â”‚  while running:                                            â”‚   â”‚
â”‚  â”‚      transcript = stt_to_llm_queue.get(timeout=1)          â”‚   â”‚
â”‚  â”‚      response = ollama.generate(transcript)                â”‚   â”‚
â”‚  â”‚      llm_to_tts_queue.put(response)                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  TTS Worker Thread (daemon)                                â”‚   â”‚
â”‚  â”‚  while running:                                            â”‚   â”‚
â”‚  â”‚      response = llm_to_tts_queue.get(timeout=1)            â”‚   â”‚
â”‚  â”‚      wav = piper.synthesize(response)                      â”‚   â”‚
â”‚  â”‚      audio.play(wav)                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Health Monitor Thread (daemon, optional)                  â”‚   â”‚
â”‚  â”‚  while running:                                            â”‚   â”‚
â”‚  â”‚      time.sleep(health_check_interval)                     â”‚   â”‚
â”‚  â”‚      log_memory_usage()                                    â”‚   â”‚
â”‚  â”‚      log_queue_depths()                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Queue Message Flow

```
CONVERSATION CYCLE (Single User Query â†’ Response)

Time   Component      Action                    Queue State
â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0ms    User           Starts speaking           Empty
...    STT            Capturing audio           Empty
2000ms STT            Silence detected          Empty
2150ms STT            Vosk inference complete   Empty
2151ms STT            put(transcript)           Q1: [transcript]

2152ms LLM            get(transcript)           Q1: Empty
2153ms LLM            Ollama API call...        Q1: Empty, Q2: Empty
2850ms LLM            Response received         Q1: Empty, Q2: Empty
2851ms LLM            put(response)             Q1: Empty, Q2: [response]

2852ms TTS            get(response)             Q1: Empty, Q2: Empty
2853ms TTS            Piper synthesis...        Q1: Empty, Q2: Empty
3150ms TTS            WAV ready, playing        Q1: Empty, Q2: Empty
4000ms TTS            Playback complete         Q1: Empty, Q2: Empty

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Total Latency: 4000ms (from speech start to playback end)
User-Perceived Latency: 2000ms (from silence to speech start)
```

---

## ğŸ“ˆ Latency Waterfall

```
User speaks: "Hello"
â”‚
â”œâ”€ [0ms â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 2000ms] User Speaking + Silence Detection
â”‚                                (STT waiting for silence)
â”‚
â””â”€â–¶ Speech Ends (t=2000ms)
    â”‚
    â”œâ”€ [2000ms â”€â”€ 2150ms] STT Processing (Vosk Inference)
    â”‚                     â”œâ”€ Audio buffering: 50ms
    â”‚                     â”œâ”€ Vosk recognition: 100ms
    â”‚                     â””â”€ Queue put: <1ms
    â”‚
    â””â”€â–¶ Transcript Ready: "hello" (t=2150ms)
        â”‚
        â”œâ”€ [2150ms â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 2850ms] LLM Processing (Ollama)
        â”‚                               â”œâ”€ Queue get: <1ms
        â”‚                               â”œâ”€ HTTP call: 10ms
        â”‚                               â”œâ”€ Qwen2.5 inference: 680ms
        â”‚                               â””â”€ Queue put: <1ms
        â”‚
        â””â”€â–¶ Response Ready: "Hi there!" (t=2850ms)
            â”‚
            â”œâ”€ [2850ms â”€â”€â”€â”€ 3150ms] TTS Processing (Piper)
            â”‚                        â”œâ”€ Queue get: <1ms
            â”‚                        â”œâ”€ Piper synthesis: 250ms
            â”‚                        â”œâ”€ WAV write: 50ms
            â”‚                        â””â”€ Playback start: <1ms
            â”‚
            â””â”€â–¶ User Hears Response (t=3150ms)
                â”‚
                â””â”€ [3150ms â”€â”€ 4000ms] Audio Playback Duration
                                      (depends on response length)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Breakdown:
  STT:   150ms  (6.5% of total)
  LLM:   700ms  (30% of total) âš ï¸ BOTTLENECK
  TTS:   300ms  (13% of total)
  Play:  850ms  (36% of total, unavoidable)
  Other: 300ms  (13%, user speaking time not counted)
Total: 2300ms (user-perceived latency from silence to hearing response)
```

---

## ğŸ—ï¸ Directory Structure

```
pluto/
â”‚
â”œâ”€â”€ ğŸ“„ README.md                    # Project overview
â”œâ”€â”€ ğŸ“„ QUICKSTART.md                # 5-minute setup guide
â”œâ”€â”€ ğŸ“„ DOCUMENTATION.md             # Complete technical reference
â”œâ”€â”€ ğŸ“„ ARCHITECTURE.md              # Design decisions
â”œâ”€â”€ ğŸ“„ DIAGRAMS.md                  # This file - visual references
â”œâ”€â”€ ğŸ“„ FILE_INDEX.md                # Navigation guide
â”‚
â”œâ”€â”€ ğŸ“„ run.py                       # Entry point
â”œâ”€â”€ ğŸ“„ requirements.txt             # Python dependencies
â”œâ”€â”€ ğŸ“„ setup.py                     # Package configuration
â”œâ”€â”€ ğŸ“„ .env.example                 # Environment template
â”œâ”€â”€ ğŸ“„ .gitignore                   # Git exclusions
â”œâ”€â”€ ğŸ“„ LICENSE                      # MIT License
â”‚
â”œâ”€â”€ ğŸ“ src/                         # Source code
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py              # Package initialization
â”‚   â”œâ”€â”€ ğŸ“„ config.py                # Configuration system
â”‚   â”œâ”€â”€ ğŸ“„ metrics_logger.py        # Performance tracking
â”‚   â”œâ”€â”€ ğŸ“„ orchestrator.py          # Main coordinator
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ workers/                 # Worker modules
â”‚       â”œâ”€â”€ ğŸ“„ __init__.py          # Worker exports
â”‚       â”œâ”€â”€ ğŸ“„ stt_worker.py        # Speech-to-Text (Vosk)
â”‚       â”œâ”€â”€ ğŸ“„ llm_worker.py        # Language Model (Ollama)
â”‚       â””â”€â”€ ğŸ“„ tts_worker.py        # Text-to-Speech (Piper)
â”‚
â”œâ”€â”€ ğŸ“ models/                      # Model storage (download separately)
â”‚   â”œâ”€â”€ ğŸ“„ .gitkeep                 # Preserve directory
â”‚   â”œâ”€â”€ ğŸ“ vosk-model-small-en-us-0.15/  (download)
â”‚   â””â”€â”€ ğŸ“„ en_US-lessac-medium.onnx      (download)
â”‚
â”œâ”€â”€ ğŸ“ logs/                        # Metrics output
â”‚   â”œâ”€â”€ ğŸ“„ .gitkeep                 # Preserve directory
â”‚   â”œâ”€â”€ ğŸ“„ metrics_YYYYMMDD_HHMMSS.csv
â”‚   â”œâ”€â”€ ğŸ“„ metrics_YYYYMMDD_HHMMSS.json
â”‚   â””â”€â”€ ğŸ“„ summary_YYYYMMDD_HHMMSS.txt
â”‚
â””â”€â”€ ğŸ“ tests/                       # Test suite
    â””â”€â”€ ğŸ“„ test_integration.py      # Integration tests
```

---

## ğŸ”„ State Transition Diagram

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   UNINITIALIZED     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ orchestrator.initialize()
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”Œâ”€â”€â”€â”€â–¶â”‚    INITIALIZING     â”‚â”€â”€â”€â”€â”
              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ Worker fails
              â”‚                â”‚ All workers   â”‚
              â”‚                â”‚ start OK      â–¼
              â”‚                â–¼            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  ERROR   â”‚
              â”‚     â”‚      READY          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                â”‚ orchestrator.run()
              â”‚                â–¼
              â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚     â”‚      RUNNING        â”‚â—€â”€â”€â”€â”€â”
              â”‚     â”‚  (Processing audio) â”‚     â”‚ Continuous
              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ operation
              â”‚                â”‚                â”‚
              â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                â”‚
              â”‚                â”‚ SIGINT / SIGTERM / Ctrl+C
              â”‚                â–¼
              â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â””â”€â”€â”€â”€â”€â”‚    SHUTTING DOWN    â”‚
                    â”‚ (Cleanup resources) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      STOPPED        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Memory Usage Over Time

```
Memory (MB)
3000 â”‚                                  â”Œâ”€ LLM Peak (inference)
     â”‚                                  â”‚
2500 â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                    â”‚             â”‚
2000 â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â””â”€ LLM Idle
     â”‚         â”‚          â”‚
1500 â”‚    â”Œâ”€â”€â”€â”€â”¤          â”‚
     â”‚    â”‚    â”‚          â””â”€ TTS Active
1000 â”‚    â”‚    â”‚
     â”‚    â”‚    â””â”€ STT Active
 500 â”‚    â”‚
     â”‚â”€â”€â”€â”€â”˜â”€ Baseline (orchestrator + config)
   0 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â–¶ Time
        Init  STT  LLM  TTS Conv Conv Conv  Idle
             warm warm warm  #1   #2   #3

Baseline: ~50MB (Python + orchestrator)
+ STT:    ~150MB (Vosk model loaded)
+ LLM:    ~2GB (Qwen2.5 during inference, ~1.5GB idle)
+ TTS:    ~200MB (Piper model loaded)
Peak:     ~2.5GB (LLM inference + all components)
```

---

## ğŸ¯ Bottleneck Identification

```
COMPONENT LATENCY COMPARISON (Typical Values)

STT (Vosk)           â–ˆâ–ˆâ–ˆâ–ˆ 150ms          âš¡ Fast
                     

LLM (Qwen2.5)        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 850ms  âš ï¸  BOTTLENECK
                     

TTS (Piper)          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 300ms       âœ… Acceptable
                     

Audio Playback       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 600ms    â¸ï¸  Unavoidable
                     (depends on response length)


0ms        200ms      400ms      600ms      800ms     1000ms
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤

OPTIMIZATION PRIORITIES:
1. ğŸ”´ LLM inference (try smaller model, better quantization, GPU?)
2. ğŸŸ¡ TTS synthesis (try smaller Piper model for speed)
3. ğŸŸ¢ STT already optimal for offline use
```

---

## ğŸ”Œ External Dependencies

```
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘    PLUTO COMPONENTS      â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                      â”‚                      â”‚
        â–¼                      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vosk Library  â”‚      â”‚   Ollama     â”‚      â”‚    Piper     â”‚
â”‚  (Embedded)   â”‚      â”‚   Server     â”‚      â”‚   Binary     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚                      â”‚
        â–¼                     â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vosk Model    â”‚      â”‚  Qwen2.5     â”‚      â”‚ Piper Model  â”‚
â”‚ vosk-model-   â”‚      â”‚  Model       â”‚      â”‚ en_US-lessac â”‚
â”‚ small-en-us   â”‚      â”‚  (pulled)    â”‚      â”‚ -medium.onnx â”‚
â”‚ ~40MB         â”‚      â”‚  ~1GB        â”‚      â”‚ ~60MB        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Download locations:
â€¢ Vosk: https://alphacephei.com/vosk/models
â€¢ Ollama: ollama pull qwen2.5:1.5b-instruct-q4_K_M
â€¢ Piper: https://github.com/rhasspy/piper/releases
```

---

**All diagrams represent the actual implemented architecture.**  
See [ARCHITECTURE.md](ARCHITECTURE.md) for design rationale and [DOCUMENTATION.md](DOCUMENTATION.md) for code reference.
